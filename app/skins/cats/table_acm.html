<%
var table_id = models.table;
var table = app.result_tables[table_id];
%>
    <table width="100%" cellspacing="1" class="bordered rank_table highlight">
        <%if (models.contests.length > 1) {%>
        <tr bgcolor="#ccccff">
            <th colspan="2"></th>
            <%for(var j = 0; j < models.contests.length; ++j) {%>
            <%
            var contest_id = models.contests[j];
            var contest = app.contests[contest_id];
            %>
            <th colspan="<%=contest.problems.length%>"><%=contest.start_time.format("dd.mm.yyyy")%></th>
            <%
            };
            %>
            <th colspan="4"></th>
        </tr>
        <%}%>
        <tr bgcolor="#ccccff">
        <th width="1%"></th><th>Название команды</th>

        <%
        var problems_cnt = 0;
        for(var j = 0; j < models.contests.length; ++j) {
            problems_cnt += app.contests[models.contests[j]].problems.length;
        }
        var w = Math.floor(50 / (problems_cnt + 1));
        w = w < 3 ? 3 : w > 10 ? 10 : w;
        var problems_stats = [], prob_idx = 0;
        %>
        <%for(var j = 0; j < models.contests.length; ++j) {%>
            <%
                var contest_id = models.contests[j];
                var contest = app.contests[contest_id];
                for (var i = 0; i < contest.problems.length; ++i) {
            %>
            <th width="<%=w%>%">
            <%
                problems_stats[prob_idx] = {s: 0, t: 0};
                var c = CATS.App.problems[contest.problems[i]];
                prob_idx++;
            %>
                <a href="<%=c.text_url%>" alt="<%=c.name%>" title="<%=c.name%>"><%=c.code%></a>
            </th>
            <%
                };
            %>
        <%
        };
        var w = Math.floor(50 / (problems_cnt + 1));
        w = w < 3 ? 3 : w > 10 ? 10 : w;
        %>
        <th width="<%=w%>%">=</th>
        <th>время</th>
        <th>место</th>
        <th>статус</th>
    </tr>
    <input type="hidden" id="last_elem_idx" value="<%=table.score_board.length%>" />
    <%
        var use_color = 'odd', last_solved_cnt = 0, idx = 0;
        _.each(table.score_board.slice(next_page, next_page + elem_cnt), function(row) {
            if (last_solved_cnt != row['solved_cnt'])
                use_color = use_color == 'even' ? 'odd' : 'even';

            idx++;
    %>
    <tr align="center" class='<%=use_color%>' >
        <td align="right">
            <%=idx%>&nbsp;
        </td>
        <td align="left">
            <a href="<%=app.users[row['user']].description%>" title=""><%=app.users[row["user"]].name%></a>
        </td>
        <%
            for (var i = 0; i < row["problems"].length; ++i) {
        %>
        <td>
            <% if (row["problems"][i]["is_solved"]) {%>
                <%problems_stats[i]['s']++;
            %>
                <p><%=minutes_to_formated_hours(row["problems"][i]["best_run_time"])%></p>
                <%="+" + (row["problems"][i]["runs_cnt"] > 1 ? row["problems"][i]["runs_cnt"] - 1 : "")%>
            <%} else {%>
                <p></p><%=row["problems"][i]["runs_cnt"] > 0 ? ( "-" + row["problems"][i]["runs_cnt"]) : "."%>
            <%
            }
            %>
            <%problems_stats[i]['t'] += row["problems"][i]["runs_cnt"];%>
        </td>
        <%
        };
        last_solved_cnt = row['solved_cnt'];
        %>
        <td><%=row['solved_cnt']%></td>
        <td>
            <%=row["penalty"]%>
        </td>
        <td>
            <%=row["place"]%>
        </td>
        <td class="ts">
            <%=app.users[row["user"]].role%>
            <%=(app.users[row["user"]].is_remote ? "remote" : "")%>
        </td>
    </tr>
    <%
        });
    %>
    <tr>
        <td>&nbsp;</td>

        <td>Успешных попыток</td>

        <%
            for (var i = 0; i < problems_cnt; ++i) {
        %>
            <td align="center"><p>
            <%=problems_stats[i]['s'] + "/" + problems_stats[i]['t']%>
            </p><%=Math.round(problems_stats[i]['s'] / problems_stats[i]['t'] * 100)%>%</td>
        </th>
        <%
            };
        %>
        <td colspan="4">&nbsp;</td>

    </tr>
</table>